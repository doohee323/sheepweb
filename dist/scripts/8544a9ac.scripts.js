function addCenter(a,b,c){var d=a.newCenter.code,e=a.newCenter.name,f=a.newCenter.chief,g=a.newCenter.address,h=a.newCenter.phone;b.addCenter(d,e,f,g,h),""==c&&(a.newCenter.code="",a.newCenter.name="",a.newCenter.chief="",a.newCenter.address="",a.newCenter.phone="")}function getParams(a){var b=a.toString(),c=b.indexOf("(");return b.substr(c+1,b.indexOf(")")-c-1).replace(/ /g,"").split(",")}var app=angular.module("sheepwebApp",[]),config={url:"http://sheeprails.herokuapp.com",server:"rails"};app.constant("config",config).config(["$routeProvider",function(a){a.when("/centers",{controller:"CentersController",templateUrl:"./views/centers.html"}).when("/center/:code",{controller:"CenterController",templateUrl:"./views/center.html"}).when("/centerregions/:code",{controller:"CenterRegionsController",templateUrl:"./views/centerRegions.html"}).when("/regions",{controller:"RegionsController",templateUrl:"./views/regions.html"}).otherwise({redirectTo:"/centers"})}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]);var headers={Accept:"application/json","Content-type":"application/json"};app.service("transManager",function(){var a;this.init=function(b){a=b},this.retrieve=function(b,c,d,e){a({method:c,url:b,params:d,data:d,headers:headers}).success(function(a){e(a)}).error(function(a,b){a=b,e(a)})},this.save=function(b,c,d,e){a({method:c,url:b,data:d,headers:headers}).success(function(a){e(a)}).error(function(a,b){a=b,e(a)})}}),app.controller("CentersController",["$rootScope","$scope","$http","$location","$routeParams","config","transManager","centersService",function($rootScope,$scope,$http,$location,$routeParams,config,transManager,centersService){$rootScope.centers={},$rootScope.regions={};var params=getParams(this.constructor);if(!$rootScope.$http)for(var p in params)angular.equals(params[p],"$rootScope")||($rootScope[params[p]]=eval(params[p]));centersService.init($rootScope),centersService.retrieveCenters(function(a){$scope.centers=a,$rootScope.centers=angular.copy(a)}),$scope.$watch("centers",function(){},!0),$scope.addCenter=function(){addCenter($scope,centersService,"INSERT")},$scope.deleteCenter=function(a){centersService.deleteCenter(a)},$scope.saveCenter=function(){centersService.saveCenter()}}]),app.controller("CenterController",["$rootScope","$scope","$http","$location","$routeParams","config","transManager","centersService",function($rootScope,$scope,$http,$location,$routeParams,config,transManager,centersService){var params=getParams(this.constructor);if(!$rootScope.$http)for(var p in params)angular.equals(params[p],"$rootScope")||($rootScope[params[p]]=eval(params[p]));centersService.init($rootScope),$scope.newCenter={},$scope.newCenter=centersService.getCenter($routeParams.code),$scope.addCenter=function(){addCenter($scope,centersService,"UPDATE")},$scope.listCenter=function(){$location.path("/centers")},$scope.saveCenter=function(){centersService.saveCenter()}}]),app.controller("CenterRegionsController",["$scope","centersService",function(a,b){a.center={},a.regionsTotal=0,a.center=b.getCenter($routeParams.code)}]),app.controller("NavbarController",["$scope","$location",function(a,b){a.getClass=function(a){return b.path().substr(0,a.length)==a?!0:!1}}]),app.controller("RegionChildController",["$scope","$http","$location","transManager","centersService",function(a,b,c,d,e){e.init(d,a,b,c),a.orderby="regionCode",a.reverse=!1,a.regionsTotal=0,e.retrieveRegions(a,function(b){a.center.regions=b,a.center&&a.center.regions&&(a.regionsTotal=a.center.regions.length)}),a.setOrder=function(b){b===a.orderby&&(a.reverse=!a.reverse),a.orderby=b}}]),app.directive("commbutton",["$compile",function($compile){var getTemplate=function(a,b){var c='<button id="'+a+b+'" class="btn btn-primary" type="button"';return"add"==a&&(c+=' data-ng-disabled="!new'+b+".name || !new"+b+".chief || !new"+b+'.address"'),c+=">"+a+" "+b+"</button>"},linker=function(scope,element,attr){element.html(getTemplate(attr.type,attr.data)).show(),element.bind("click",function(){eval("scope."+attr.type+attr.data+"()")}),$compile(element.contents())(scope)};return{restrict:"E",link:linker,replace:!0}}]),app.directive("animatedView",["$route","$anchorScroll","$compile","$controller",function(a,b,c,d){return{restrict:"ECA",terminal:!0,link:function(e,f,g){function h(){n&&(n.$destroy(),n=null)}function i(){f.html(""),h()}function j(){o=a.current&&a.current.locals,p=o&&o.$template,p?r.disabled?m():f.children().length>0?l(r.viewExitAnimation):k(r.viewEnterAnimation):i()}function k(a){$(f).css("display","block"),m(),l(a)}function l(a){switch(a){case"fadeOut":$(f.children()).animate({},r.duration,function(){k("slideLeft")});break;case"slideLeft":$(f.children()).animate({left:"-="+r.slideAmount,opacity:1},r.duration);break;case"slideRight":$(f.children()).animate({left:"+="+r.slideAmount,opacity:1},r.duration)}}function m(){f.html(p),h();var g,i=c(f.contents()),j=a.current;n=j.scope=e.$new(),j.controller&&(o.$scope=n,g=d(j.controller,o),f.children().data("$ngControllerController",g)),i(n),n.$emit("$viewContentLoaded"),n.$eval(q),b()}var n,o,p,q=g.onload||"",r={duration:500,viewEnterAnimation:"slideLeft",viewExitAnimation:"fadeOut",slideAmount:50,disabled:!1},s=e.$eval(g.animations);angular.extend(r,s),e.$on("$routeChangeSuccess",j),j()}}}]),angular.module("sheepwebApp").filter("myFilter",function(){return function(a){return"myFilter filter: "+a}}),app.service("centersService",function(){var a,b,c,d,e,f;this.init=function(g){a=g.config,c=g,d=c.$$childTail,e=c.$http,f=c.$location,b=c.transManager,b.init(e)},this.retrieveCenters=function(d){var e="/uip_centers.json",f="get";"spring"==a.server&&(e="/retrieveCenterList.ajax",f="post"),b.retrieve(a.url+e,f,{params:{code:""}},function(b){"spring"==a.server&&(b=b.output1),c.centers=angular.copy(b),d&&d(b)})},this.retrieveRegions=function(e){var f="/uip_regions.json",g="get";"spring"==a.server&&(f="/retrieveRegionList.ajax",g="post");var h=d.center.code;b.retrieve(a.url+f,g,{params:{code:""}},function(b){"spring"==a.server&&(b=b.output1);for(var d=0;d<c.centers.length;d++)c.centers[d].code==h+""&&(c.regions=angular.copy(b));e&&e(b)})},this.saveCenter=function(e){var f={};f=this.setParam(c.centers,f,"uip_center"),f=this.setParam(c.regions,f,"uip_region");var g,h;"spring"==a.server?(g="/saveCenterRegion.ajax",h="post"):(f=f.uip_center[0],"INSERT"==f.rowStatus?(h="POST",g="/uip_centers.json"):(g="/uip_centers/"+f.id+".json",h="UPDATE"==f.rowStatus?"PATCH":"DELETE")),b.save(a.url+g,h,f,function(b){"spring"==a.server&&(b=b.output1),e&&e(b),c.centers=angular.copy(d.centers)})},this.addCenter=function(a,b,e,f,g){var h=!1;if(a)for(var i=0;i<c.centers.length;i++)if(c.centers[i].code==a+""){c.centers[i].name=b,c.centers[i].chief=e,c.centers[i].address=f,c.centers[i].phone=g,d.newCenter=c.centers[i],c.centers[i].rowStatus="UPDATE",h=!0;break}if(!h){var j=c.centers.length+1;c.centers.push({code:j,name:b,chief:e,address:f,phone:g});var k=c.centers.length-1;c.centers[k].rowStatus="INSERT",d.centers=angular.copy(c.centers)}return d.$apply(),d},this.deleteCenter=function(a){for(var b=c.centers,e=b.length-1;e>=0;e--)if(b[e].code==a+""){c.centers[e].rowStatus="DELETE",d.centers.splice(e,1);break}for(var f=c.regions,e=f.length-1;e>=0;e--)if(f[e].code==a+""){c.regions[e].rowStatus="DELETE",d.regions.splice(e,1);break}},this.getCenter=function(a){for(var b=c.centers,d=0;d<b.length;d++)if(b[d].code==a+"")return b[d].rowStatus="NORMAL",b[d];return null},this.setParam=function(a,b,c){var d=angular.copy(a);if(d&&d.length>0)for(var e=d.length-1;e>=0;e--)d[e].rowStatus&&"NORMAL"!=d[e].rowStatus||d.splice(e,1);return Object.keys(d).length>0&&(b[c]=d),b}}),angular.module("sheepwebApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);